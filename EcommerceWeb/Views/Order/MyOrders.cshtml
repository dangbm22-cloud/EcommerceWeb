@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model List<EcommerceWeb.Models.Order>

<section class="my-orders spad">
    <div class="container">
        <h2>📦 Đơn hàng của tôi</h2>
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Mã đơn</th>
                    <th>Ngày tạo</th>
                    <th>Tổng tiền</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model)
                {
                    <tr>
                        <td>@order.Id</td>
                        <td>@order.CreatedAt.ToLocalTime()</td>
                        <td>@string.Format("{0:N0} VND", order.Total)</td>
                        <td>@EcommerceWeb.Helpers.OrderStatusHelper.GetClientStatus(order.Status)</td>
                        <td>
                            <a asp-controller="Order" asp-action="Status" asp-route-id="@order.Id" class="site-btn">
                                Xem chi tiết
                            </a>

                            @* Nút hủy đơn: chỉ hiện khi Pending *@
                            @if (order.Status == "Pending")
                            {
                                <button type="button" class="site-btn btn-danger" onclick="confirmCancel('@order.Id')">
                                    Hủy đơn
                                </button>
                            }

                            @* Nút xác nhận nhận hàng: chỉ hiện khi Shipped *@
                            @if (order.Status == "Shipped")
                            {
                                <button type="button" class="site-btn btn-success" onclick="confirmReceived('@order.Id')">
                                    Đã nhận hàng
                                </button>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</section>

@section Scripts {
    <script>
        function confirmCancel(orderId) {
            if (confirm("Bạn có chắc chắn muốn hủy đơn hàng này?")) {
                const form = document.createElement("form");
                form.method = "post";
                form.action = "/Order/Cancel"; // cần tạo action Cancel trong OrderController

                const idInput = document.createElement("input");
                idInput.type = "hidden";
                idInput.name = "id";
                idInput.value = orderId;
                form.appendChild(idInput);

                document.body.appendChild(form);
                form.submit();
            }
        }

        function confirmReceived(orderId) {
            if (confirm("Bạn có chắc chắn đã nhận được hàng?")) {
                const form = document.createElement("form");
                form.method = "post";
                form.action = "/Order/Complete"; // cần tạo action Complete trong OrderController

                const idInput = document.createElement("input");
                idInput.type = "hidden";
                idInput.name = "id";
                idInput.value = orderId;
                form.appendChild(idInput);

                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
}
